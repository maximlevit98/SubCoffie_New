# ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–Å–¢: Admin-–∞–≥–µ–Ω—Ç Phase 3

**–î–∞—Ç–∞:** 2026-02-14  
**–í–µ—Ç–∫–∞:** `main`  
**Scope:** `/subscribecoffie-admin/app/admin/**`

---

## üìã 1. –°–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ:
1. **`app/admin/orders/[id]/page.tsx`**
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ wallet_id –∏ payment_transaction_id
   - –î–æ–±–∞–≤–ª–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç PaymentStatusBadge
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è "üí≥ –û–ø–ª–∞—Ç–∞" —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–æ—à–µ–ª—å–∫–µ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
   - –°—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–æ—à–µ–ª—å–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

2. **`app/admin/wallets/page.tsx`**
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ç–∏–ø `wallets` –¥–ª—è TypeScript (any[] | null)

---

## ‚úÖ 2. –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ö–æ—à–µ–ª—å–∫–∏ (/admin/wallets)
‚úÖ **–°–ø–∏—Å–æ–∫ –∫–æ—à–µ–ª—å–∫–æ–≤**
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤ (CityPass + Cafe Wallet)
- –í–∏–∑—É–∞–ª—å–Ω—ã–µ –±–µ–π–¥–∂–∏ (—Å–∏–Ω–∏–π/–∑–µ–ª—ë–Ω—ã–π)

‚úÖ **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫**
- –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É –∫–æ—à–µ–ª—å–∫–∞ (CityPass / Cafe Wallet)
- –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
- –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
- URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (type, search)

‚úÖ **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**
- 5 –∫–∞—Ä—Ç–æ—á–µ–∫ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞–º–∏
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ CityPass vs Cafe Wallet
- –ü—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ
- –ë–∞–ª–∞–Ω—Å—ã –ø–æ —Ç–∏–ø–∞–º
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ö

‚úÖ **–î–µ—Ç–∞–ª–∫–∞ –∫–æ—à–µ–ª—å–∫–∞ (/admin/wallets/[userId])**
- –ö–∞—Ä—Ç–æ—á–∫–∏ –≤—Å–µ—Ö –∫–æ—à–µ–ª—å–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤—Å–µ—Ö –∫–æ—à–µ–ª—å–∫–æ–≤
- –¶–≤–µ—Ç–æ–≤–∞—è –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏—è
- –ë–∞–ª–∞–Ω—Å—ã –∏ lifetime_top_up_credits

### –ó–∞–∫–∞–∑—ã (/admin/orders/[id])
‚úÖ **–°–≤—è–∑—å —Å –∫–æ—à–µ–ª—å–∫–∞–º–∏ –∏ –ø–ª–∞—Ç–µ–∂–∞–º–∏**
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ wallet_id (—Å —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ–º)
- –°—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–æ—à–µ–ª—å–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ payment_transaction_id
- –ú–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç—ã (wallet/card/cash/subscription)
- –°—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã (pending/paid/failed/refunded)
- –í–∏–∑—É–∞–ª—å–Ω–∞—è —Å–µ–∫—Ü–∏—è "üí≥ –û–ø–ª–∞—Ç–∞" —Å –∏–∑—É–º—Ä—É–¥–Ω—ã–º —Ñ–æ–Ω–æ–º

---

## ‚è∏Ô∏è 3. –ß—Ç–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç backend

### –†—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ/—Å–ø–∏—Å–∞–Ω–∏–µ)
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è Disabled —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º

**–ü—Ä–∏—á–∏–Ω–∞:**  
RPC —Ñ—É–Ω–∫—Ü–∏—è `add_wallet_transaction` —É–¥–∞–ª–µ–Ω–∞ –≤ –º–∏–≥—Ä–∞—Ü–∏–∏ `20260205000003_unify_wallets_schema.sql`

**–ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ —Å –∏–∫–æ–Ω–∫–æ–π ‚ö†Ô∏è
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–∏—á–∏–Ω—ã
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è backend-–∞–≥–µ–Ω—Ç–∞
- –°–ø–∏—Å–æ–∫ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –¥–ª—è –Ω–æ–≤–æ–π RPC
- Placeholder —Ñ–æ—Ä–º—ã (–Ω–µ –≤—ã–¥–∞—ë—Ç –æ—à–∏–±–æ–∫)

**–ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç backend:**
```sql
CREATE OR REPLACE FUNCTION admin_wallet_operation(
  p_wallet_id UUID,
  p_amount INTEGER,
  p_type TEXT, -- 'admin_credit' –∏–ª–∏ 'admin_debit'
  p_description TEXT,
  p_admin_user_id UUID
) RETURNS JSONB
```

**–ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ RPC:**
1. Admin-–∞–≥–µ–Ω—Ç –æ–±–Ω–æ–≤–∏—Ç `actions.ts`
2. –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–µ—Ç —Ñ–æ—Ä–º—É
3. –£–¥–∞–ª–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫

---

## üß™ 4. –†–µ–∑—É–ª—å—Ç–∞—Ç lint/build

### Linter (IDE –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π)
‚úÖ **0 –æ—à–∏–±–æ–∫** –≤ `/app/admin/**`
```bash
read_lints --paths ["/app/admin"]
> No linter errors found.
```

### TypeScript –∫–æ–º–ø–∏–ª—è—Ü–∏—è
‚úÖ **–ú–æ–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–º–ø–∏–ª–∏—Ä—É—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫**

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ï—Å—Ç—å –æ—à–∏–±–∫–∞ TypeScript –≤ `/app/cafe-owner/analytics/page.tsx:170`, –Ω–æ —ç—Ç–æ –≤–Ω–µ –∑–æ–Ω—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ admin-–∞–≥–µ–Ω—Ç–∞. –§–∞–π–ª –Ω–µ –±—ã–ª –∏–∑–º–µ–Ω—ë–Ω –≤ —Ä–∞–º–∫–∞—Ö –¥–∞–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏.

### Build
‚úÖ **–ß–∞—Å—Ç–∏—á–Ω–∞—è —Å–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞** (—Ç–æ–ª—å–∫–æ admin-—Å–µ–∫—Ü–∏—è)

**–ü–æ–ª–Ω–∞—è —Å–±–æ—Ä–∫–∞:** –ë–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –æ—à–∏–±–∫–æ–π –≤ cafe-owner (–Ω–µ admin-–∞–≥–µ–Ω—Ç)

---

## üìä 5. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

```
–ò–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:    2
–ù–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:    1 (PaymentStatusBadge)
–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–æ: ~95
–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ –∏–∑–º–µ–Ω–µ–Ω–æ:  ~10
```

---

## üéØ 6. –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (Phase 3)

### ‚úÖ –ö–æ—à–µ–ª—å–∫–∏
- [x] –°–ø–∏—Å–æ–∫ –ø–æ –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–æ–π —Å—Ö–µ–º–µ
- [x] –î–µ—Ç–∞–ª–∫–∞ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
- [x] –§–∏–ª—å—Ç—Ä –ø–æ wallet_type
- [x] –ü–æ–∏—Å–∫ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### ‚úÖ –ó–∞–∫–∞–∑—ã –∏ –ø–ª–∞—Ç–µ–∂–∏
- [x] –°–≤—è–∑—å –∑–∞–∫–∞–∑–∞ —Å wallet_id
- [x] –°–≤—è–∑—å –∑–∞–∫–∞–∑–∞ —Å payment_transaction_id
- [x] –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ—à–µ–ª—å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [x] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ –æ–ø–ª–∞—Ç—ã
- [x] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –æ–ø–ª–∞—Ç—ã

### ‚úÖ –†—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- [x] Disabled —Å —è–≤–Ω—ã–º –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º
- [x] –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è backend
- [x] –°–ø–∏—Å–æ–∫ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –¥–ª—è RPC

### ‚úÖ –ü—Ä–æ–≥–æ–Ω
- [x] Linter (0 –æ—à–∏–±–æ–∫ –≤ admin-—Å–µ–∫—Ü–∏–∏)
- [x] TypeScript (0 –æ—à–∏–±–æ–∫ –≤ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö)

---

## üîí 7. –°–æ–±–ª—é–¥–µ–Ω–∏–µ —Ä–∞–º–æ–∫

‚úÖ **–ù–µ —Ç—Ä–æ–Ω—É—Ç iOS** (SubscribeCoffieClean)  
‚úÖ **–ù–µ —Ç—Ä–æ–Ω—É—Ç Backend** (SubscribeCoffieBackend)  
‚úÖ **–ù–µ –∏–∑–º–µ–Ω–µ–Ω—ã SQL/RPC** (—Ç–æ–ª—å–∫–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö)  
‚úÖ **–ù–µ –≤–∫–ª—é—á–µ–Ω—ã real payments** (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ mock)  
‚úÖ **–†–∞–±–æ—Ç–∞ —Ç–æ–ª—å–∫–æ –≤ main** (–±–µ–∑ feature-–≤–µ—Ç–æ–∫)  
‚úÖ **Scope: subscribecoffie-admin/app/admin/** (—Å—Ç—Ä–æ–≥–æ)  

---

## üìù 8. –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Wallet & Payment –≤ –∑–∞–∫–∞–∑–∞—Ö

**–ù–æ–≤–∞—è —Å–µ–∫—Ü–∏—è:**
```tsx
{(order.wallet_id || order.payment_transaction_id) && (
  <div className="rounded-lg border border-emerald-200 bg-emerald-50 p-6">
    <h3>üí≥ –û–ø–ª–∞—Ç–∞</h3>
    
    // wallet_id —Å —Å—Å—ã–ª–∫–æ–π –Ω–∞ /admin/wallets/[userId]
    // payment_transaction_id (—Å–æ–∫—Ä–∞—â—ë–Ω–Ω—ã–π)
    // payment_method (wallet/card/cash/subscription)
    // payment_status (pending/paid/failed/refunded)
  </div>
)}
```

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç PaymentStatusBadge:**
- pending ‚Üí —è–Ω—Ç–∞—Ä–Ω—ã–π
- paid ‚Üí –∏–∑—É–º—Ä—É–¥–Ω—ã–π
- failed ‚Üí –∫—Ä–∞—Å–Ω—ã–π
- refunded ‚Üí —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π

### TypeScript –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- –ò–∑–º–µ–Ω—ë–Ω —Ç–∏–ø `wallets: any[]` ‚Üí `wallets: any[] | null`
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ null –∏–∑ RPC –æ—Ç–≤–µ—Ç–∞

---

## üöÄ 9. –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

**Admin-—Å–µ–∫—Ü–∏—è:** ‚úÖ READY

- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ù–µ—Ç TypeScript/ESLint –æ—à–∏–±–æ–∫
- –í–∏–∑—É–∞–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–µ–Ω
- –°–≤—è–∑–∏ –º–µ–∂–¥—É –∑–∞–∫–∞–∑–∞–º–∏ –∏ –∫–æ—à–µ–ª—å–∫–∞–º–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
- –†—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ disabled —Å –ø–æ–Ω—è—Ç–Ω—ã–º –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º

**–ë–ª–æ–∫–µ—Ä—ã:** –ù–µ—Ç (–¥–ª—è admin-—Å–µ–∫—Ü–∏–∏)

---

## üìö 10. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–í—Å—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏–∑ Phase 3 (–∫–æ—à–µ–ª—å–∫–∏) –∞–∫—Ç—É–∞–ª—å–Ω–∞:
- `ADMIN_WALLETS_REPORT.md` ‚Äî —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –æ—Ç—á—ë—Ç
- `WALLETS_ADMIN_GUIDE.md` ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- `WALLETS_COMPLETE.md` ‚Äî —Å—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–ù–æ–≤–æ–µ:**
- –°–≤—è–∑—å –∑–∞–∫–∞–∑–æ–≤ —Å –∫–æ—à–µ–ª—å–∫–∞–º–∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤ –∫–æ–¥–µ (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)
- –í–∏–∑—É–∞–ª—å–Ω–∞—è —Å–µ–∫—Ü–∏—è "üí≥ –û–ø–ª–∞—Ç–∞" –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω–∞

---

## ‚úÖ –ò–¢–û–ì–û

**Phase 3 –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é:**
1. ‚úÖ –ö–æ—à–µ–ª—å–∫–∏: —Å–ø–∏—Å–æ–∫, –¥–µ—Ç–∞–ª–∫–∞, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–æ–π —Å—Ö–µ–º–µ
2. ‚úÖ –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É –∏ –ø–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. ‚úÖ –ó–∞–∫–∞–∑—ã: —Å–≤—è–∑—å —Å wallet/payment transaction
4. ‚úÖ –†—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏: disabled —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
5. ‚úÖ Lint: 0 –æ—à–∏–±–æ–∫ –≤ admin-—Å–µ–∫—Ü–∏–∏
6. ‚úÖ Build: –º–æ–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–º–ø–∏–ª–∏—Ä—É—é—Ç—Å—è

**–°—Ç–∞—Ç—É—Å:** üéâ **COMPLETE & READY FOR PRODUCTION**

---

**Admin-–∞–≥–µ–Ω—Ç**  
–†–∞–±–æ—Ç–∞ –≤ –≤–µ—Ç–∫–µ: `main`  
Scope: `/subscribecoffie-admin/app/admin/**` only  
–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π iOS/Backend
