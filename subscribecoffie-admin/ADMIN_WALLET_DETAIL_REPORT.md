# Admin Wallet Detail - Implementation Report
**Date:** 2026-02-15  
**Agent:** Admin-Agent-2  
**Scope:** Wallet Detail Page with Tabs

---

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Admin RPC (–¥–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)

**–ù–æ–≤—ã–µ —Ç–∏–ø—ã TypeScript:**
- `AdminWalletOverview` ‚Äî –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ—à–µ–ª—å–∫–µ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- `AdminWalletTransaction` ‚Äî —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å actor –∏ order —Å–≤—è–∑—è–º–∏
- `AdminWalletPayment` ‚Äî –ø–ª–∞—Ç—ë–∂–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –∫–æ–º–∏—Å—Å–∏—è–º–∏
- `AdminWalletOrder` ‚Äî –∑–∞–∫–∞–∑—ã —Å itemized —Å–æ—Å—Ç–∞–≤–æ–º

**–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `lib/supabase/queries/wallets.ts`:**
```typescript
getWalletOverview(walletId)           // admin_get_wallet_overview RPC
getWalletTransactionsAdmin(...)       // admin_get_wallet_transactions RPC
getWalletPayments(...)                // admin_get_wallet_payments RPC
getWalletOrders(...)                  // admin_get_wallet_orders RPC
```

### 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å —Ç–∞–±–∞–º–∏

**–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞** (`app/admin/wallets/[userId]/page.tsx`):
- Server component
- –ü–æ–ª—É—á–∞–µ—Ç user_id –∏–∑ URL
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –∫–æ—à–µ–ª—å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ `getWalletsByUserId()`
- –í—ã–±–∏—Ä–∞–µ—Ç primary wallet (–ø–µ—Ä–≤—ã–π, –æ–±—ã—á–Ω–æ CityPass)
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ `Promise.all()`
- –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤
- –ü–µ—Ä–µ–¥–∞—ë—Ç –¥–∞–Ω–Ω—ã–µ –≤ `WalletDetailClient`

**Client component** (`WalletDetailClient.tsx`):
- –£–ø—Ä–∞–≤–ª—è–µ—Ç state —Ç–∞–±–æ–≤
- –£–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∫–ª–∞–¥–∫–∏
- –†–µ–Ω–¥–µ—Ä–∏—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏—é —Ç–∞–±–æ–≤ —Å —Å—á—ë—Ç—á–∏–∫–∞–º–∏
- –ü–µ—Ä–µ–¥–∞—ë—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ç–∞–±–æ–≤

### 3. –í–∫–ª–∞–¥–∫–∞ "–û–±–∑–æ—Ä" (`OverviewTab.tsx`)

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ—à–µ–ª—å–∫–µ:
  - –¢–∏–ø –∫–æ—à–µ–ª—å–∫–∞ (CityPass / Cafe Wallet)
  - –ö–∞—Ñ–µ/—Å–µ—Ç—å (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
  - ID –∫–æ—à–µ–ª—å–∫–∞
  - –î–∞—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:
  - –§–ò–û, email, —Ç–µ–ª–µ—Ñ–æ–Ω
  - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
  - –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- ‚úÖ –ë–∞–ª–∞–Ω—Å (–±–æ–ª—å—à–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞):
  - –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å (–∫—Ä—É–ø–Ω–æ)
  - –í—Å–µ–≥–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–æ
  - –°—Ä–µ–¥–Ω–∏–π —á–µ–∫
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (4 –∫–∞—Ä—Ç–æ—á–∫–∏):
  - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (—Å breakdown: –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è/–æ–ø–ª–∞—Ç—ã/–≤–æ–∑–≤—Ä–∞—Ç—ã)
  - –ó–∞–∫–∞–∑—ã (–∑–∞–≤–µ—Ä—à–µ–Ω–æ / –ø—Ä–æ—á–∏–µ)
  - –ü–ª–∞—Ç—ë–∂–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
  - –í–æ–∑–≤—Ä–∞—Ç—ã
- ‚úÖ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ (–ø–æ—Å–ª–µ–¥–Ω—è—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è/–ø–ª–∞—Ç—ë–∂/–∑–∞–∫–∞–∑)

### 4. –í–∫–ª–∞–¥–∫–∞ "–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏" (`TransactionsTab.tsx`)

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:
  - –î–∞—Ç–∞/–≤—Ä–µ–º—è (—Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è)
  - –¢–∏–ø (badge: –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ/–±–æ–Ω—É—Å/–æ–ø–ª–∞—Ç–∞/–≤–æ–∑–≤—Ä–∞—Ç/–∞–¥–º–∏–Ω)
  - –û–ø–∏—Å–∞–Ω–∏–µ + –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä (actor)
  - –ë–∞–ª–∞–Ω—Å –¥–æ
  - –°—É–º–º–∞ (—Å —Ü–≤–µ—Ç–æ–º: –∑–µ–ª—ë–Ω—ã–π +, –∫—Ä–∞—Å–Ω—ã–π ‚àí)
  - –ë–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ
  - –°–≤—è–∑–∏ (—Å—Å—ã–ª–∫–∞ –Ω–∞ –∑–∞–∫–∞–∑, –µ—Å–ª–∏ –µ—Å—Ç—å)
- ‚úÖ Empty state (—Å –∏–∫–æ–Ω–∫–æ–π)
- ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è (–∫–Ω–æ–ø–∫–∏ –≤–ø–µ—Ä—ë–¥/–Ω–∞–∑–∞–¥)

### 5. –í–∫–ª–∞–¥–∫–∞ "–ü–ª–∞—Ç–µ–∂–∏" (`PaymentsTab.tsx`)

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ –ø–ª–∞—Ç–µ–∂–µ–π:
  - –î–∞—Ç–∞/–≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è + –≤—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
  - –¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ (topup/payment/refund)
  - –°—Ç–∞—Ç—É—Å (pending/completed/failed/cancelled/refunded)
  - –°—É–º–º–∞
  - –ö–æ–º–∏—Å—Å–∏—è (–∫—Ä–∞—Å–Ω—ã–º, –µ—Å–ª–∏ > 0)
  - Net Amount (–∑–µ–ª—ë–Ω—ã–º)
  - –î–µ—Ç–∞–ª–∏:
    - –°—Å—ã–ª–∫–∞ –Ω–∞ –∑–∞–∫–∞–∑
    - Payment method ID
    - Provider transaction ID
    - Idempotency key (–µ—Å–ª–∏ –µ—Å—Ç—å)
- ‚úÖ Empty state
- ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è

### 6. –í–∫–ª–∞–¥–∫–∞ "–ó–∞–∫–∞–∑—ã" (`OrdersTab.tsx`)

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ (–∫–∞—Ä—Ç–æ—á–∫–∏):
  - **–•–µ–¥–µ—Ä:**
    - –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞ (—Å—Å—ã–ª–∫–∞ –Ω–∞ detail)
    - –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
    - –°—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã
    - –î–∞—Ç–∞/–≤—Ä–µ–º—è
    - –ö–∞—Ñ–µ
    - –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞
    - –ë–æ–Ω—É—Å—ã (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã)
  
  - **–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞ (itemized):**
    - –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
    - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ
    - –¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É
    - –ò—Ç–æ–≥–æ –ø–æ —Å—Ç—Ä–æ–∫–µ
    - –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
  
  - **–§—É—Ç–µ—Ä:**
    - –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞, —Ç–µ–ª–µ—Ñ–æ–Ω
    - –°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã
    - –ü–æ–¥—ã—Ç–æ–≥
    - –ë–æ–Ω—É—Å—ã
    - –û–ø–ª–∞—á–µ–Ω–æ
- ‚úÖ Empty state
- ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è

### 7. UX-—Å–æ—Å—Ç–æ—è–Ω–∏—è

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ **Loading**: Handled by Next.js SSR (Suspense –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- ‚úÖ **Error states**: –ö—Ä–∞—Å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º
- ‚úÖ **Empty states**: –í–æ –≤—Å–µ—Ö —Ç–∞–±–∞—Ö (–∏–∫–æ–Ω–∫–∞ + —Å–æ–æ–±—â–µ–Ω–∏–µ)
- ‚úÖ **Multiple wallets indicator**: –ò–Ω—Ñ–æ-–±–ª–æ–∫ –≤–≤–µ—Ä—Ö—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ **Null handling**: –í—Å–µ nullable –ø–æ–ª—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ optional chaining

---

## üìÅ –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

```
lib/supabase/queries/wallets.ts
  + 4 –Ω–æ–≤—ã—Ö —Ç–∏–ø–∞ (AdminWalletOverview, etc.)
  + 4 –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (getWalletOverview, etc.)
  + ~170 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
```

```
app/admin/wallets/[userId]/page.tsx
  - –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω
  + –ò—Å–ø–æ–ª—å–∑—É–µ—Ç admin RPC –≤–º–µ—Å—Ç–æ legacy actions
  + –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤
  + Error/empty states
  - ~150 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ —É–¥–∞–ª–µ–Ω–æ
  + ~175 —Å—Ç—Ä–æ–∫ –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞
```

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

```
app/admin/wallets/[userId]/WalletDetailClient.tsx
  + Client component –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–∞–±–∞–º–∏
  + –ù–∞–≤–∏–≥–∞—Ü–∏—è —Å —Å—á—ë—Ç—á–∏–∫–∞–º–∏
  + State management –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
  + ~150 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
```

```
app/admin/wallets/[userId]/OverviewTab.tsx
  + –í–∫–ª–∞–¥–∫–∞ "–û–±–∑–æ—Ä"
  + Wallet info, user info, balance, stats
  + ~220 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
```

```
app/admin/wallets/[userId]/TransactionsTab.tsx
  + –í–∫–ª–∞–¥–∫–∞ "–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"
  + –¢–∞–±–ª–∏—Ü–∞ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
  + Transaction type/amount badges
  + ~160 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
```

```
app/admin/wallets/[userId]/PaymentsTab.tsx
  + –í–∫–ª–∞–¥–∫–∞ "–ü–ª–∞—Ç–µ–∂–∏"
  + –¢–∞–±–ª–∏—Ü–∞ —Å –∫–æ–º–∏—Å—Å–∏—è–º–∏
  + Payment status badges
  + ~180 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
```

```
app/admin/wallets/[userId]/OrdersTab.tsx
  + –í–∫–ª–∞–¥–∫–∞ "–ó–∞–∫–∞–∑—ã"
  + –ö–∞—Ä—Ç–æ—á–∫–∏ —Å itemized breakdown
  + Order/payment status badges
  + Modifiers display
  + ~280 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
```

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

### Lint

```bash
npx eslint lib/supabase/queries/wallets.ts \
             app/admin/wallets/[userId]/page.tsx \
             app/admin/wallets/[userId]/WalletDetailClient.tsx \
             app/admin/wallets/[userId]/OverviewTab.tsx \
             app/admin/wallets/[userId]/TransactionsTab.tsx \
             app/admin/wallets/[userId]/PaymentsTab.tsx \
             app/admin/wallets/[userId]/OrdersTab.tsx
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ 0 –æ—à–∏–±–æ–∫, 0 –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í —Å—Ç–∞—Ä–æ–º —Ñ–∞–π–ª–µ `AddTransactionForm.tsx` (–Ω–µ –≤—Ö–æ–¥–∏—Ç –≤ scope) –µ—Å—Ç—å 1 –æ—à–∏–±–∫–∞ `any`, –Ω–æ —ç—Ç–æ –Ω–µ –±—ã–ª–æ –∑–∞—Ç—Ä–æ–Ω—É—Ç–æ –≤ —Ä–∞–º–∫–∞—Ö —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏.

### Build

‚ö†Ô∏è –ï—Å—Ç—å –æ—à–∏–±–∫–∏ TypeScript –≤ –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–∞—Ö –∞–¥–º–∏–Ω–∫–∏ (–Ω–µ —Å–≤—è–∑–∞–Ω—ã —Å wallets)

**–ú–æ–π –∫–æ–¥ (wallets detail):** ‚úÖ –ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

---

## üéØ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º

### –í–∫–ª–∞–¥–∫–∏
- [x] –û–±–∑–æ—Ä ‚Äî –ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ—à–µ–ª—å–∫–µ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- [x] –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Äî —Å —Ç–∏–ø–∞–º–∏, –±–∞–ª–∞–Ω—Å–∞–º–∏, —Å–≤—è–∑—è–º–∏
- [x] –ü–ª–∞—Ç–µ–∂–∏ ‚Äî —Å –∫–æ–º–∏—Å—Å–∏—è–º–∏, —Å—Ç–∞—Ç—É—Å–∞–º–∏, detal—è–º–∏
- [x] –ó–∞–∫–∞–∑—ã ‚Äî —Å itemized —Å–æ—Å—Ç–∞–≤–æ–º

### –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- [x] `admin_get_wallet_overview` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω
- [x] `admin_get_wallet_transactions` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω
- [x] `admin_get_wallet_payments` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω
- [x] `admin_get_wallet_orders` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω

### –ó–∞–∫–∞–∑—ã (–¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è)
- [x] Itemized —Å–æ—Å—Ç–∞–≤ (item_name, qty, price, line_total)
- [x] –î–∞—Ç–∞/–≤—Ä–µ–º—è –∑–∞–∫–∞–∑–∞
- [x] –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –∏ –æ–ø–ª–∞—Ç—ã
- [x] –°—É–º–º—ã (subtotal, bonus_used, paid)
- [x] –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã (—Å fallback –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤)

### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- [x] –¢–∏–ø/–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ/—Å—É–º–º–∞
- [x] –ë–∞–ª–∞–Ω—Å –¥–æ/–ø–æ—Å–ª–µ
- [x] –°–≤—è–∑–∏ –Ω–∞ order/payment
- [x] Actor (–∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä) –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏

### –ü–ª–∞—Ç–µ–∂–∏
- [x] –°—É–º–º–∞, –∫–æ–º–∏—Å—Å–∏—è, net amount
- [x] –°—Ç–∞—Ç—É—Å, method/provider
- [x] –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- [x] Idempotency key (–µ—Å–ª–∏ –µ—Å—Ç—å –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ)

### UX
- [x] Loading/empty/error states
- [x] –ü–∞–≥–∏–Ω–∞—Ü–∏—è –≤ —Ç–∞–±–ª–∏—á–Ω—ã—Ö –≤–∫–ª–∞–¥–∫–∞—Ö
- [x] –ß–∏—Ç–∞–±–µ–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç (toLocaleString)
- [x] –ß–∏—Ç–∞–±–µ–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–µ–Ω–µ–≥ (–∫—Ä–µ–¥–∏—Ç—ã —Å –∑–Ω–∞–∫–æ–º)

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ | 2 |
| –§–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–Ω–æ | 5 |
| –ù–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ TypeScript | 4 |
| –ù–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π | 4 |
| Lines of Code (–Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã) | ~1,160 |
| Lines of Code (–∏–∑–º–µ–Ω–µ–Ω–æ) | ~200 |
| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ React | 7 (4 tab + 3 helper) |
| –û—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞ (–≤ scope) | 0 |

---

## üß™ Manual Smoke Test

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–±–∑–æ—Ä –∫–æ—à–µ–ª—å–∫–∞
1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ `/admin/wallets`
2. –ö–ª–∏–∫–Ω—É—Ç—å "–î–µ—Ç–∞–ª–∏" –¥–ª—è –ª—é–±–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. **–û–∂–∏–¥–∞–µ—Ç—Å—è:**
   - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è tab "–û–±–∑–æ—Ä" (–∞–∫—Ç–∏–≤–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
   - –í–∏–¥–Ω—ã –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –±–∞–ª–∞–Ω—Å–æ–º –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
   - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞
   - –°—á—ë—Ç—á–∏–∫–∏ –≤ —Ç–∞–±–∞—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –¥–∞–Ω–Ω—ã–º

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
1. –ù–∞ detail-—Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–ª–∏–∫–Ω—É—Ç—å tab "–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"
2. **–û–∂–∏–¥–∞–µ—Ç—Å—è:**
   - –¢–∞–±–ª–∏—Ü–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   - –¢–∏–ø—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å badges
   - –°—É–º–º—ã —Å —Ü–≤–µ—Ç–æ–º (+ –∑–µ–ª—ë–Ω—ã–π, ‚àí –∫—Ä–∞—Å–Ω—ã–π)
   - –ë–∞–ª–∞–Ω—Å –¥–æ/–ø–æ—Å–ª–µ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
   - –°—Å—ã–ª–∫–∞ –Ω–∞ –∑–∞–∫–∞–∑ (–µ—Å–ª–∏ –µ—Å—Ç—å order_id)

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–ª–∞—Ç–µ–∂–µ–π
1. –ö–ª–∏–∫–Ω—É—Ç—å tab "–ü–ª–∞—Ç–µ–∂–∏"
2. **–û–∂–∏–¥–∞–µ—Ç—Å—è:**
   - –¢–∞–±–ª–∏—Ü–∞ –ø–ª–∞—Ç–µ–∂–µ–π
   - –ö–æ–º–∏—Å—Å–∏—è –ø–æ–∫–∞–∑–∞–Ω–∞ –∫—Ä–∞—Å–Ω—ã–º
   - Net amount –ø–æ–∫–∞–∑–∞–Ω –∑–µ–ª—ë–Ω—ã–º
   - –°—Ç–∞—Ç—É—Å—ã —Å badges
   - –î–µ—Ç–∞–ª–∏ (provider, idempotency key) –µ—Å–ª–∏ –µ—Å—Ç—å

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–æ–≤
1. –ö–ª–∏–∫–Ω—É—Ç—å tab "–ó–∞–∫–∞–∑—ã"
2. **–û–∂–∏–¥–∞–µ—Ç—Å—è:**
   - –ö–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–∫–∞–∑–æ–≤
   - Itemized breakdown –≤–∏–¥–µ–Ω
   - –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - –°—É–º–º—ã (subtotal, bonus, paid) –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
   - –°—Å—ã–ª–∫–∞ –Ω–∞ detail –∑–∞–∫–∞–∑–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–æ—à–µ–ª—å–∫–∏
1. –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∫–æ—à–µ–ª—å–∫–∞–º–∏
2. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ detail
3. **–û–∂–∏–¥–∞–µ—Ç—Å—è:**
   - –°–∏–Ω–∏–π –∏–Ω—Ñ–æ-–±–ª–æ–∫ –≤–≤–µ—Ä—Ö—É
   - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ—à–µ–ª—å–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è primary wallet (–ø–µ—Ä–≤—ã–π)

### –°—Ü–µ–Ω–∞—Ä–∏–π 6: Empty states
1. –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π/–ø–ª–∞—Ç–µ–∂–µ–π/–∑–∞–∫–∞–∑–æ–≤
2. **–û–∂–∏–¥–∞–µ—Ç—Å—è:**
   - –í –∫–∞–∂–¥–æ–π –ø—É—Å—Ç–æ–π –≤–∫–ª–∞–¥–∫–µ ‚Äî –∏–∫–æ–Ω–∫–∞ –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ
   - –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π 7: –ü–∞–≥–∏–Ω–∞—Ü–∏—è
1. –ï—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π > 50, –∫–Ω–æ–ø–∫–∞ "–í–ø–µ—Ä—ë–¥" –∞–∫—Ç–∏–≤–Ω–∞
2. –ö–ª–∏–∫–Ω—É—Ç—å "–í–ø–µ—Ä—ë–¥"
3. **–û–∂–∏–¥–∞–µ—Ç—Å—è:**
   - –°—á—ë—Ç—á–∏–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è
   - TODO: –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–≤ –±—É–¥—É—â–µ–º)

---

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Backend

### RPC —Ñ—É–Ω–∫—Ü–∏–∏ (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)
| –§—É–Ω–∫—Ü–∏—è | –°—Ç–∞—Ç—É—Å | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|---------|--------|---------------|
| `admin_get_wallet_overview(wallet_id)` | ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | –û–±–∑–æ—Ä –∫–æ—à–µ–ª—å–∫–∞ |
| `admin_get_wallet_transactions(wallet_id, limit, offset)` | ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ |
| `admin_get_wallet_payments(wallet_id, limit, offset)` | ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | –ü–ª–∞—Ç–µ–∂–∏ |
| `admin_get_wallet_orders(wallet_id, limit, offset)` | ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | –ó–∞–∫–∞–∑—ã |
| `get_user_wallets(user_id)` | ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | –°–ø–∏—Å–æ–∫ –∫–æ—à–µ–ª—å–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |

### RPC —Ñ—É–Ω–∫—Ü–∏–∏ (–ù–ï –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)
| –§—É–Ω–∫—Ü–∏—è | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|---------|-------------|
| `admin_get_wallets(...)` | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ list-—Å—Ç—Ä–∞–Ω–∏—Ü–µ (Phase 3.1) |

---

## üìå –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### 1. Server-side –ø–∞–≥–∏–Ω–∞—Ü–∏—è
**–°—Ç–∞—Ç—É—Å:** –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –ª–æ–≥–∏–∫–∞ –≥–æ—Ç–æ–≤–∞, –Ω–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–∏ –∫–ª–∏–∫–µ "–í–ø–µ—Ä—ë–¥" —Å—á—ë—Ç—á–∏–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –º–µ–Ω—è–µ—Ç—Å—è, –Ω–æ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å —Å–µ—Ä–≤–µ—Ä–∞  
**–†–µ—à–µ–Ω–∏–µ:** –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥–µ–ª–∫–∞ –Ω–∞ client component —Å `useEffect` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Next.js API routes  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** Low (50 –∑–∞–ø–∏—Å–µ–π –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∫–æ—à–µ–ª—å–∫–æ–≤)

### 2. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–æ—à–µ–ª—å–∫–∏
**–°—Ç–∞—Ç—É—Å:** –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è primary wallet  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ—à–µ–ª—å–∫–æ–≤, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å wallet selector (dropdown –∏–ª–∏ —Ç–∞–±—ã)  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** Medium

### 3. –†—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (add/debit)
**–°—Ç–∞—Ç—É—Å:** –ù–µ–¥–æ—Å—Ç—É–ø–Ω—ã (–∏–∑ Phase 3.0)  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ù–µ—Ç RPC –¥–ª—è admin_wallet_operation  
**–†–µ—à–µ–Ω–∏–µ:** Backend-–∞–≥–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—É—é RPC  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** High (–¥–ª—è full admin —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏)

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–æ—à–µ–ª—å–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å:
- ‚úÖ 4 –≤–∫–ª–∞–¥–∫–∞–º–∏ (–û–±–∑–æ—Ä/–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏/–ü–ª–∞—Ç–µ–∂–∏/–ó–∞–∫–∞–∑—ã)
- ‚úÖ –ü–æ–ª–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π admin RPC
- ‚úÖ Itemized breakdown –∑–∞–∫–∞–∑–æ–≤
- ‚úÖ UX states (loading/empty/error)
- ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏–µ–π (UI –≥–æ—Ç–æ–≤)
- ‚úÖ 0 –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞

---

**–î–∞—Ç–∞:** 2026-02-15  
**Agent:** Admin-Agent-2  
**Phase:** 3.2 (Wallet Detail)

**Commit message (draft):**
```
feat(admin): implement wallet detail page with tabs

- Add 4 admin RPC integration functions (overview/transactions/payments/orders)
- Create 4 TypeScript types for admin RPC responses
- Implement OverviewTab with wallet info, user info, balance, stats
- Implement TransactionsTab with balance tracking and actor info
- Implement PaymentsTab with commission and net amount display
- Implement OrdersTab with itemized breakdown (item/qty/price/modifiers)
- Add WalletDetailClient for tabs navigation and state
- Refactor detail page to use admin RPCs instead of legacy actions
- Add multiple wallets indicator
- Implement empty/error states for all tabs
- Add pagination UI (ready for server-side implementation)
- Fix: all TypeScript types, 0 lint errors

Phase 3.2 complete. Pagination backend next.
```
