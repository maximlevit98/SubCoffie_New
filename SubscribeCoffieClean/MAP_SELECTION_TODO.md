# üó∫Ô∏è MapSelectionView Restoration - –ü–æ—à–∞–≥–æ–≤—ã–π –ü–ª–∞–Ω

> –°—Ç–∞—Ç—É—Å: üìã –ì–æ—Ç–æ–≤ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é  
> –°–æ–∑–¥–∞–Ω: 2026-02-04  
> –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 2-4 —á–∞—Å–∞ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç–∞)

---

## üìä –ü—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

```
–§–∞–∑–∞ 1: Backend - Regions          [ ] 0/5 –∑–∞–¥–∞—á
–§–∞–∑–∞ 2: Backend - Recommendations   [ ] 0/5 –∑–∞–¥–∞—á  
–§–∞–∑–∞ 3: iOS - Services              [ ] 0/2 –∑–∞–¥–∞—á–∏
–§–∞–∑–∞ 4: iOS - UI Components         [ ] 0/3 –∑–∞–¥–∞—á–∏
–§–∞–∑–∞ 5: iOS - MapSelectionView      [ ] 0/2 –∑–∞–¥–∞—á–∏
–§–∞–∑–∞ 6: iOS - ContentView           [ ] 0/1 –∑–∞–¥–∞—á–∞
–§–∞–∑–∞ 7: Testing                     [ ] 0/5 –∑–∞–¥–∞—á
–§–∞–∑–∞ 8: Documentation               [ ] 1/2 –∑–∞–¥–∞—á–∏

–ò–¢–û–ì–û: 1/25 –∑–∞–¥–∞—á (4%)
```

---

## üéØ –í–´–ë–û–† –í–ê–†–ò–ê–ù–¢–ê –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Ø

–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –≤—ã–±–µ—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç:

### –í–∞—Ä–∏–∞–Ω—Ç A: –ü–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ ‚≠ê (—Ä–µ–∫–æ–º–µ–Ω–¥—É—é)
- [x] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–∫–ª—é—á–µ–Ω—ã
- [x] –¢—Ä–µ–±—É–µ—Ç: –§–∞–∑—ã 1-8
- [x] Backend –º–∏–≥—Ä–∞—Ü–∏–∏: –î–ê (regions + recommendations)
- [x] –í—Ä–µ–º—è: 3-4 —á–∞—Å–∞

### –í–∞—Ä–∏–∞–Ω—Ç B: –° —Ä–µ–≥–∏–æ–Ω–∞–º–∏
- [ ] –ë–µ–∑ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
- [ ] –¢—Ä–µ–±—É–µ—Ç: –§–∞–∑—ã 1, 3 (—á–∞—Å—Ç–∏—á–Ω–æ), 4-8
- [ ] Backend –º–∏–≥—Ä–∞—Ü–∏–∏: –î–ê (—Ç–æ–ª—å–∫–æ regions)
- [ ] –í—Ä–µ–º—è: 2-3 —á–∞—Å–∞

### –í–∞—Ä–∏–∞–Ω—Ç C: –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ
- [ ] –¢–æ–ª—å–∫–æ –ø–æ–∏—Å–∫ + —Ñ–∏–ª—å—Ç—Ä—ã + –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å
- [ ] –¢—Ä–µ–±—É–µ—Ç: –§–∞–∑—ã 5-8
- [ ] Backend –º–∏–≥—Ä–∞—Ü–∏–∏: –ù–ï–¢
- [ ] –í—Ä–µ–º—è: 1-2 —á–∞—Å–∞

**–í—ã–±—Ä–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç:** `_____`

---

## üìã –§–ê–ó–ê 1: Backend - Regions (–ú–Ω–æ–≥–æ—Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å)

> **–¶–µ–ª—å:** –í–∫–ª—é—á–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ä–µ–≥–∏–æ–Ω–æ–≤ –≤ backend  
> **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –ù–µ—Ç  
> **–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è:** –í–∞—Ä–∏–∞–Ω—Ç–æ–≤ A, B

### –ó–∞–¥–∞—á–∞ 1.1: –í–∫–ª—é—á–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é multiregion
- [ ] **–®–∞–≥ 1:** –û—Ç–∫—Ä—ã—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª
  ```bash
  cd SubscribeCoffieBackend/supabase/migrations
  ```

- [ ] **–®–∞–≥ 2:** –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏
  ```bash
  mv 20260220000000_multiregion.sql.disabled 20260220000000_multiregion.sql
  ```

- [ ] **–®–∞–≥ 3:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
  ```bash
  ls -la | grep multiregion
  ```

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** –§–∞–π–ª –±–µ–∑ `.disabled` —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è ‚úÖ

---

### –ó–∞–¥–∞—á–∞ 1.2: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é regions
- [ ] **–®–∞–≥ 1:** –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–µ–Ω—å Backend
  ```bash
  cd ../../
  ```

- [ ] **–®–∞–≥ 2:** –°–¥–µ–ª–∞—Ç—å backup —Ç–µ–∫—É—â–µ–π –ë–î (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  ```bash
  npx supabase db dump > backup_before_regions_$(date +%Y%m%d_%H%M%S).sql
  ```

- [ ] **–®–∞–≥ 3:** –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
  ```bash
  npx supabase db reset
  ```

- [ ] **–®–∞–≥ 4:** –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 1-2 –º–∏–Ω—É—Ç—ã)

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** –ö–æ–º–∞–Ω–¥–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å –±–µ–∑ –æ—à–∏–±–æ–∫ ‚úÖ

---

### –ó–∞–¥–∞—á–∞ 1.3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- [ ] **–®–∞–≥ 1:** –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î
  ```bash
  psql "postgresql://postgres:postgres@127.0.0.1:54322/postgres"
  ```

- [ ] **–®–∞–≥ 2:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É regions
  ```sql
  SELECT * FROM public.regions;
  ```
  **–û–∂–∏–¥–∞–µ—Ç—Å—è:** –¢–∞–±–ª–∏—Ü–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–∞—è)

- [ ] **–®–∞–≥ 3:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É cafe_regions
  ```sql
  SELECT * FROM public.cafe_regions;
  ```
  **–û–∂–∏–¥–∞–µ—Ç—Å—è:** –¢–∞–±–ª–∏—Ü–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–∞—è)

- [ ] **–®–∞–≥ 4:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å RPC —Ñ—É–Ω–∫—Ü–∏–∏
  ```sql
  \df public.get_all_regions
  \df public.get_cafes_in_region
  ```
  **–û–∂–∏–¥–∞–µ—Ç—Å—è:** –û–±–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞–π–¥–µ–Ω—ã

- [ ] **–®–∞–≥ 5:** –í—ã–π—Ç–∏ –∏–∑ psql
  ```sql
  \q
  ```

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∏ RPC —Å—É—â–µ—Å—Ç–≤—É—é—Ç ‚úÖ

---

### –ó–∞–¥–∞—á–∞ 1.4: –î–æ–±–∞–≤–∏—Ç—å seed data –¥–ª—è regions
- [ ] **–®–∞–≥ 1:** –û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª seed.sql
  ```bash
  code supabase/seed.sql
  # –∏–ª–∏ nano supabase/seed.sql
  ```

- [ ] **–®–∞–≥ 2:** –ù–∞–π—Ç–∏ –º–µ—Å—Ç–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (–ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ñ–µ)

- [ ] **–®–∞–≥ 3:** –î–æ–±–∞–≤–∏—Ç—å –∫–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–≥–∏–æ–Ω–æ–≤
  ```sql
  -- ============================================================================
  -- REGIONS SEED DATA
  -- ============================================================================
  
  DO $$
  DECLARE
    v_moscow_region_id uuid;
    v_spb_region_id uuid;
    v_test_cafe_id uuid;
    v_maxcoffee_id uuid;
  BEGIN
    RAISE NOTICE 'üåç Creating regions...';
    
    -- Moscow
    INSERT INTO public.regions (name, city, country, timezone, is_active, latitude, longitude)
    VALUES ('–ú–æ—Å–∫–≤–∞', '–ú–æ—Å–∫–≤–∞', '–†–æ—Å—Å–∏—è', 'Europe/Moscow', true, 55.7558, 37.6173)
    ON CONFLICT (city, country) DO UPDATE SET name = EXCLUDED.name
    RETURNING id INTO v_moscow_region_id;
    
    RAISE NOTICE '‚úÖ Created Moscow region: %', v_moscow_region_id;
    
    -- Saint Petersburg
    INSERT INTO public.regions (name, city, country, timezone, is_active, latitude, longitude)
    VALUES ('–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–†–æ—Å—Å–∏—è', 'Europe/Moscow', true, 59.9343, 30.3351)
    ON CONFLICT (city, country) DO UPDATE SET name = EXCLUDED.name
    RETURNING id INTO v_spb_region_id;
    
    RAISE NOTICE '‚úÖ Created SPb region: %', v_spb_region_id;
    
    -- Assign existing cafes to Moscow region
    SELECT id INTO v_test_cafe_id FROM public.cafes WHERE name = 'Test Coffee Point' LIMIT 1;
    SELECT id INTO v_maxcoffee_id FROM public.cafes WHERE name = 'MaxCoffee' LIMIT 1;
    
    IF v_test_cafe_id IS NOT NULL THEN
      INSERT INTO public.cafe_regions (cafe_id, region_id)
      VALUES (v_test_cafe_id, v_moscow_region_id)
      ON CONFLICT DO NOTHING;
      RAISE NOTICE '‚úÖ Assigned Test Coffee Point to Moscow';
    END IF;
    
    IF v_maxcoffee_id IS NOT NULL THEN
      INSERT INTO public.cafe_regions (cafe_id, region_id)
      VALUES (v_maxcoffee_id, v_moscow_region_id)
      ON CONFLICT DO NOTHING;
      RAISE NOTICE '‚úÖ Assigned MaxCoffee to Moscow';
    END IF;
    
  END $$;
  ```

- [ ] **–®–∞–≥ 4:** –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª

- [ ] **–®–∞–≥ 5:** –ü—Ä–∏–º–µ–Ω–∏—Ç—å seed data
  ```bash
  npx supabase db reset
  ```

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** –í –ë–î –µ—Å—Ç—å —Ä–µ–≥–∏–æ–Ω—ã –ú–æ—Å–∫–≤–∞ –∏ –°–ü–± ‚úÖ

---

### –ó–∞–¥–∞—á–∞ 1.5: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É regions
- [ ] **–®–∞–≥ 1:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–µ–≥–∏–æ–Ω—ã
  ```bash
  psql "postgresql://postgres:postgres@127.0.0.1:54322/postgres" -c "SELECT id, name, city FROM regions;"
  ```
  **–û–∂–∏–¥–∞–µ—Ç—Å—è:** 2 —Å—Ç—Ä–æ–∫–∏ (–ú–æ—Å–∫–≤–∞, –°–ü–±)

- [ ] **–®–∞–≥ 2:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –∫–∞—Ñ–µ-—Ä–µ–≥–∏–æ–Ω—ã
  ```bash
  psql "postgresql://postgres:postgres@127.0.0.1:54322/postgres" -c "SELECT c.name, r.name as region FROM cafes c JOIN cafe_regions cr ON c.id = cr.cafe_id JOIN regions r ON cr.region_id = r.id;"
  ```
  **–û–∂–∏–¥–∞–µ—Ç—Å—è:** –ö–∞—Ñ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω—ã —Ä–µ–≥–∏–æ–Ω–∞–º

- [ ] **–®–∞–≥ 3:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å RPC
  ```bash
  psql "postgresql://postgres:postgres@127.0.0.1:54322/postgres" -c "SELECT * FROM get_all_regions(false);"
  ```
  **–û–∂–∏–¥–∞–µ—Ç—Å—è:** JSON —Å —Ä–µ–≥–∏–æ–Ω–∞–º–∏ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∫–∞—Ñ–µ

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ ‚úÖ

---

## üìã –§–ê–ó–ê 2: Backend - Recommendations (–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

> **–¶–µ–ª—å:** –í–∫–ª—é—á–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π  
> **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –ù–µ—Ç  
> **–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è:** –í–∞—Ä–∏–∞–Ω—Ç–∞ A

> ‚ö†Ô∏è **–ü–†–û–ü–£–°–¢–ò –≠–¢–£ –§–ê–ó–£** –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –í–∞—Ä–∏–∞–Ω—Ç B –∏–ª–∏ C

### –ó–∞–¥–∞—á–∞ 2.1: –í–∫–ª—é—á–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é recommendations
- [ ] **–®–∞–≥ 1:** –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏
  ```bash
  cd SubscribeCoffieBackend/supabase/migrations
  mv 20260212000000_recommendations.sql.disabled 20260212000000_recommendations.sql
  ```

- [ ] **–®–∞–≥ 2:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–∞—Ü–∏—é
  ```bash
  ls -la | grep recommendations
  ```

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** –§–∞–π–ª –±–µ–∑ `.disabled` ‚úÖ

---

### –ó–∞–¥–∞—á–∞ 2.2: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é recommendations
- [ ] **–®–∞–≥ 1:** –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
  ```bash
  cd ../../
  npx supabase db reset
  ```

- [ ] **–®–∞–≥ 2:** –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** –ö–æ–º–∞–Ω–¥–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å –±–µ–∑ –æ—à–∏–±–æ–∫ ‚úÖ

---

### –ó–∞–¥–∞—á–∞ 2.3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã/views
- [ ] **–®–∞–≥ 1:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å user_preferences
  ```bash
  psql "postgresql://postgres:postgres@127.0.0.1:54322/postgres" -c "\d user_preferences"
  ```

- [ ] **–®–∞–≥ 2:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å trending_items view
  ```bash
  psql "postgresql://postgres:postgres@127.0.0.1:54322/postgres" -c "\dv trending_items"
  ```

- [ ] **–®–∞–≥ 3:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å RPC —Ñ—É–Ω–∫—Ü–∏–∏
  ```bash
  psql "postgresql://postgres:postgres@127.0.0.1:54322/postgres" -c "\df get_cafe_recommendations"
  psql "postgresql://postgres:postgres@127.0.0.1:54322/postgres" -c "\df get_personalized_recommendations"
  ```

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** –í—Å–µ –æ–±—ä–µ–∫—Ç—ã —Å–æ–∑–¥–∞–Ω—ã ‚úÖ

---

### –ó–∞–¥–∞—á–∞ 2.4: –î–æ–±–∞–≤–∏—Ç—å seed data –¥–ª—è recommendations
- [ ] **–®–∞–≥ 1:** –û—Ç–∫—Ä—ã—Ç—å seed.sql
  ```bash
  code supabase/seed.sql
  ```

- [ ] **–®–∞–≥ 2:** –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞
  ```sql
  -- ============================================================================
  -- RECOMMENDATIONS TEST DATA
  -- ============================================================================
  
  DO $$
  DECLARE
    v_test_user_id uuid;
  BEGIN
    RAISE NOTICE 'ü§ñ Creating recommendation test data...';
    
    -- Get test user (maxim.levitm@algsoft.ru or similar)
    SELECT id INTO v_test_user_id 
    FROM auth.users 
    WHERE email LIKE '%maxim%' OR email LIKE '%test%'
    LIMIT 1;
    
    IF v_test_user_id IS NOT NULL THEN
      -- Create user preferences
      INSERT INTO public.user_preferences (
        user_id,
        favorite_cafe_ids,
        favorite_category,
        preferred_order_time,
        avg_order_value_credits
      )
      VALUES (
        v_test_user_id,
        (SELECT ARRAY_AGG(id) FROM cafes LIMIT 2),
        'drinks',
        '09:00:00',
        250
      )
      ON CONFLICT (user_id) DO UPDATE
      SET 
        favorite_category = EXCLUDED.favorite_category,
        avg_order_value_credits = EXCLUDED.avg_order_value_credits;
      
      RAISE NOTICE '‚úÖ Created user preferences for: %', v_test_user_id;
    END IF;
  END $$;
  ```

- [ ] **–®–∞–≥ 3:** –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å
  ```bash
  npx supabase db reset
  ```

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** User preferences —Å–æ–∑–¥–∞–Ω—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚úÖ

---

### –ó–∞–¥–∞—á–∞ 2.5: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å RPC recommendations
- [ ] **–®–∞–≥ 1:** –ü–æ–ª—É—á–∏—Ç—å ID —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  ```bash
  psql "postgresql://postgres:postgres@127.0.0.1:54322/postgres" -c "SELECT id FROM auth.users WHERE email LIKE '%maxim%' LIMIT 1;"
  ```
  –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å UUID

- [ ] **–®–∞–≥ 2:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å get_cafe_recommendations
  ```bash
  # –ó–∞–º–µ–Ω–∏ YOUR_USER_ID –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π UUID
  psql "postgresql://postgres:postgres@127.0.0.1:54322/postgres" -c "SELECT * FROM get_cafe_recommendations('YOUR_USER_ID', 5);"
  ```

- [ ] **–®–∞–≥ 3:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å trending_items
  ```bash
  psql "postgresql://postgres:postgres@127.0.0.1:54322/postgres" -c "SELECT * FROM trending_items LIMIT 5;"
  ```

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** RPC –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –æ—à–∏–±–æ–∫ ‚úÖ

---

## üìã –§–ê–ó–ê 3: iOS - Services (–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤)

> **–¶–µ–ª—å:** –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Service –∫–ª–∞—Å—Å—ã –∏–∑ disabled  
> **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –§–∞–∑–∞ 1 (–¥–ª—è RegionService), –§–∞–∑–∞ 2 (–¥–ª—è RecommendationService)  
> **–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è:** –í—Å–µ—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

### –ó–∞–¥–∞—á–∞ 3.1: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å RegionService
- [ ] **–®–∞–≥ 1:** –ü–µ—Ä–µ–π—Ç–∏ –≤ iOS –ø—Ä–æ–µ–∫—Ç
  ```bash
  cd SubscribeCoffieClean
  ```

- [ ] **–®–∞–≥ 2:** –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ñ–∞–π–ª –∏–∑ disabled
  ```bash
  mv _disabled_backup/RegionService.swift.disabled \
     SubscribeCoffieClean/SubscribeCoffieClean/Helpers/RegionService.swift
  ```

- [ ] **–®–∞–≥ 3:** –û—Ç–∫—Ä—ã—Ç—å Xcode
  ```bash
  open SubscribeCoffieClean/SubscribeCoffieClean.xcodeproj
  ```

- [ ] **–®–∞–≥ 4:** –î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª –≤ –ø—Ä–æ–µ–∫—Ç (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
  - File ‚Üí Add Files to "SubscribeCoffieClean"
  - –í—ã–±—Ä–∞—Ç—å `RegionService.swift`
  - ‚úÖ Copy items if needed
  - ‚úÖ Add to targets: SubscribeCoffieClean

- [ ] **–®–∞–≥ 5:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è
  - Cmd+B (Build)
  - –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –µ—Å–ª–∏ –µ—Å—Ç—å

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** RegionService.swift –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ ‚úÖ

---

### –ó–∞–¥–∞—á–∞ 3.2: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å RecommendationService
> ‚ö†Ô∏è **–¢–û–õ–¨–ö–û –î–õ–Ø –í–ê–†–ò–ê–ù–¢–ê A** (–ø—Ä–æ–ø—É—Å—Ç–∏ –¥–ª—è B –∏ C)

- [ ] **–®–∞–≥ 1:** –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ñ–∞–π–ª –∏–∑ disabled
  ```bash
  mv _disabled_backup/RecommendationService.swift.disabled \
     SubscribeCoffieClean/SubscribeCoffieClean/Helpers/RecommendationService.swift
  ```

- [ ] **–®–∞–≥ 2:** –î–æ–±–∞–≤–∏—Ç—å –≤ Xcode –ø—Ä–æ–µ–∫—Ç (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ 3.1)

- [ ] **–®–∞–≥ 3:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–ø–∏–ª—è—Ü–∏—é
  - Cmd+B

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** RecommendationService.swift –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è ‚úÖ

---

## üìã –§–ê–ó–ê 4: iOS - UI Components (–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)

> **–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã  
> **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –§–∞–∑–∞ 3  
> **–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è:** –í—Å–µ—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

### –ó–∞–¥–∞—á–∞ 4.1: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å RegionPickerView
- [ ] **–®–∞–≥ 1:** –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ñ–∞–π–ª
  ```bash
  cd SubscribeCoffieClean
  mv _disabled_backup/RegionPickerView.swift.disabled \
     SubscribeCoffieClean/SubscribeCoffieClean/Views/RegionPickerView.swift
  ```

- [ ] **–®–∞–≥ 2:** –î–æ–±–∞–≤–∏—Ç—å –≤ Xcode (File ‚Üí Add Files)

- [ ] **–®–∞–≥ 3:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–ø–∏–ª—è—Ü–∏—é (Cmd+B)

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** RegionPickerView –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è ‚úÖ

---

### –ó–∞–¥–∞—á–∞ 4.2: –°–æ–∑–¥–∞—Ç—å CafeRecommendationsView
> ‚ö†Ô∏è **–¢–û–õ–¨–ö–û –î–õ–Ø –í–ê–†–ò–ê–ù–¢–ê A**

- [ ] **–®–∞–≥ 1:** –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª –≤ Xcode
  - Right-click –Ω–∞ Views folder
  - New File ‚Üí SwiftUI View
  - –ò–º—è: `CafeRecommendationsView`

- [ ] **–®–∞–≥ 2:** –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∏–∑ `MAP_SELECTION_RESTORATION_PLAN.md`
  - –°–µ–∫—Ü–∏—è "–§–∞–∑–∞ 4: iOS - UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã"
  - –ü–æ–¥—Å–µ–∫—Ü–∏—è "4.1. –°–æ–∑–¥–∞—Ç—å CafeRecommendationsView"

- [ ] **–®–∞–≥ 3:** –°–æ—Ö—Ä–∞–Ω–∏—Ç—å (Cmd+S)

- [ ] **–®–∞–≥ 4:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–ø–∏–ª—è—Ü–∏—é (Cmd+B)

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** CafeRecommendationsView –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è ‚úÖ

---

### –ó–∞–¥–∞—á–∞ 4.3: –°–æ–∑–¥–∞—Ç—å TrendingItemsView
> ‚ö†Ô∏è **–¢–û–õ–¨–ö–û –î–õ–Ø –í–ê–†–ò–ê–ù–¢–ê A**

- [ ] **–®–∞–≥ 1:** –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª
  - New File ‚Üí SwiftUI View
  - –ò–º—è: `TrendingItemsView`

- [ ] **–®–∞–≥ 2:** –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∏–∑ `MAP_SELECTION_RESTORATION_PLAN.md`
  - –°–µ–∫—Ü–∏—è "4.2. –°–æ–∑–¥–∞—Ç—å TrendingItemsView"

- [ ] **–®–∞–≥ 3:** –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–ø–∏–ª—è—Ü–∏—é

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** TrendingItemsView –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è ‚úÖ

---

## üìã –§–ê–ó–ê 5: iOS - MapSelectionView (–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–≥–æ View)

> **–¶–µ–ª—å:** –ó–∞–º–µ–Ω–∏—Ç—å stub –Ω–∞ –ø–æ–ª–Ω—É—é –≤–µ—Ä—Å–∏—é  
> **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –§–∞–∑–∞ 3, –§–∞–∑–∞ 4  
> **–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è:** –í—Å–µ—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

### –ó–∞–¥–∞—á–∞ 5.1: –°–¥–µ–ª–∞—Ç—å backup —Ç–µ–∫—É—â–µ–≥–æ stub
- [ ] **–®–∞–≥ 1:** –°–æ–∑–¥–∞—Ç—å backup
  ```bash
  cd SubscribeCoffieClean/SubscribeCoffieClean/SubscribeCoffieClean/Views
  cp MapSelectionView.swift MapSelectionView.swift.stub
  ```

- [ ] **–®–∞–≥ 2:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ backup —Å–æ–∑–¥–∞–Ω
  ```bash
  ls -la MapSelectionView*
  ```

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** –§–∞–π–ª `.stub` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚úÖ

---

### –ó–∞–¥–∞—á–∞ 5.2: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–ª–Ω—É—é –≤–µ—Ä—Å–∏—é
- [ ] **–®–∞–≥ 1:** –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ disabled
  ```bash
  cp ../../../_disabled_backup/MapSelectionView.swift.disabled MapSelectionView.swift
  ```

- [ ] **–®–∞–≥ 2:** –û—Ç–∫—Ä—ã—Ç—å –≤ Xcode –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

- [ ] **–®–∞–≥ 3:** –°–¥–µ–ª–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏
  
  **–ù–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫–∏:**
  ```swift
  @ObservedObject var filterStore: FilterStore
  ```
  
  **–ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞:**
  ```swift
  var filterStore: FilterStore? = nil
  var enableRecommendations: Bool = false
  var enableRegions: Bool = false
  ```

- [ ] **–®–∞–≥ 4:** –û–±–Ω–æ–≤–∏—Ç—å body –¥–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
  
  **Region picker:** –û–±–µ—Ä–Ω—É—Ç—å –≤ `if enableRegions { ... }`
  
  **Filter bar:** –û–±–µ—Ä–Ω—É—Ç—å –≤ `if filterStore != nil { ... }`
  
  **Recommendations:** –û–±–µ—Ä–Ω—É—Ç—å –≤ `if enableRecommendations { ... }`

- [ ] **–®–∞–≥ 5:** –û–±–Ω–æ–≤–∏—Ç—å `sortedCafes` –¥–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ filterStore
  ```swift
  private var sortedCafes: [CafeSummary] {
      guard let store = filterStore else {
          return filteredCafes
      }
      // ... existing sort logic
  }
  ```

- [ ] **–®–∞–≥ 6:** –û–±–Ω–æ–≤–∏—Ç—å `filterBar` computed property
  ```swift
  private var filterBar: some View {
      guard let store = filterStore else {
          return AnyView(EmptyView())
      }
      return AnyView(
          // ... existing filter bar UI
      )
  }
  ```

- [ ] **–®–∞–≥ 7:** –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–ø–∏–ª—è—Ü–∏—é (Cmd+B)

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** MapSelectionView –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ ‚úÖ

---

## üìã –§–ê–ó–ê 6: iOS - ContentView (–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)

> **–¶–µ–ª—å:** –û–±–Ω–æ–≤–∏—Ç—å ContentView –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ MapSelectionView  
> **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –§–∞–∑–∞ 5  
> **–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è:** –í—Å–µ—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

### –ó–∞–¥–∞—á–∞ 6.1: –û–±–Ω–æ–≤–∏—Ç—å ContentView
- [ ] **–®–∞–≥ 1:** –û—Ç–∫—Ä—ã—Ç—å `ContentView.swift`

- [ ] **–®–∞–≥ 2:** –ù–∞–π—Ç–∏ `case .map:` (–æ–∫–æ–ª–æ —Å—Ç—Ä–æ–∫–∏ 230)

- [ ] **–®–∞–≥ 3:** –û–±–Ω–æ–≤–∏—Ç—å –≤—ã–∑–æ–≤ MapSelectionView
  ```swift
  case .map:
      MapSelectionView(
          cafes: availableCafes,
          isLoading: cafesAreLoading,
          errorMessage: cafesLoadError,
          onRetry: {
              Task { await fetchCafesIfNeeded(force: true) }
          },
          onSelectCafe: { cafe in
              // ... existing logic
          },
          filterStore: filterStore,              // ‚úÖ ADD THIS
          enableRecommendations: false,          // ‚úÖ ADD THIS (true –¥–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–∞ A)
          enableRegions: true                    // ‚úÖ ADD THIS (true –¥–ª—è A –∏ B, false –¥–ª—è C)
      )
      .task {
          await fetchCafesIfNeeded()
      }
  ```

- [ ] **–®–∞–≥ 4:** –ù–∞–π—Ç–∏ `case .selectCafeForWallet:` (–æ–∫–æ–ª–æ —Å—Ç—Ä–æ–∫–∏ 257)

- [ ] **–®–∞–≥ 5:** –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –≤—ã–∑–æ–≤ MapSelectionView

- [ ] **–®–∞–≥ 6:** –°–æ—Ö—Ä–∞–Ω–∏—Ç—å (Cmd+S)

- [ ] **–®–∞–≥ 7:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–ø–∏–ª—è—Ü–∏—é (Cmd+B)

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** ContentView –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ ‚úÖ

---

## üìã –§–ê–ó–ê 7: Testing (–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

> **–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π  
> **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –í—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ñ–∞–∑—ã  
> **–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è:** –í—Å–µ—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

### –ó–∞–¥–∞—á–∞ 7.1: –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- [ ] **–®–∞–≥ 1:** –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Cmd+R)

- [ ] **–®–∞–≥ 2:** –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≥—Ä—É–∑–∫–∏

- [ ] **–®–∞–≥ 3:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –Ω–µ—Ç –∫—Ä–∞—à–µ–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

- [ ] **–®–∞–≥ 4:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ MapSelectionView –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –∫—Ä–∞—à–µ–π ‚úÖ

---

### –ó–∞–¥–∞—á–∞ 7.2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∏—Å–∫–∞
- [ ] **–®–∞–≥ 1:** –û—Ç–∫—Ä—ã—Ç—å MapSelectionView

- [ ] **–®–∞–≥ 2:** –í–≤–µ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ—Ñ–µ–π–Ω–∏ –≤ –ø–æ–∏—Å–∫

- [ ] **–®–∞–≥ 3:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–ø–∏—Å–æ–∫ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è

- [ ] **–®–∞–≥ 4:** –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫ (–Ω–∞–∂–∞—Ç—å X)

- [ ] **–®–∞–≥ 5:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ –∫–æ—Ñ–µ–π–Ω–∏ –≤–µ—Ä–Ω—É–ª–∏—Å—å

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ ‚úÖ

---

### –ó–∞–¥–∞—á–∞ 7.3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è –°–ø–∏—Å–æ–∫/–ö–∞—Ä—Ç–∞
- [ ] **–®–∞–≥ 1:** –ù–∞–π—Ç–∏ Segment Control "–°–ø–∏—Å–æ–∫ / –ö–∞—Ä—Ç–∞"

- [ ] **–®–∞–≥ 2:** –ù–∞–∂–∞—Ç—å "–ö–∞—Ä—Ç–∞"

- [ ] **–®–∞–≥ 3:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞—Ä—Ç–∞ (–∑–∞–≥–ª—É—à–∫–∞)

- [ ] **–®–∞–≥ 4:** –ù–∞–∂–∞—Ç—å "–°–ø–∏—Å–æ–∫"

- [ ] **–®–∞–≥ 5:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ

---

### –ó–∞–¥–∞—á–∞ 7.4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
- [ ] **–®–∞–≥ 1:** –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "–§–∏–ª—å—Ç—Ä—ã"

- [ ] **–®–∞–≥ 2:** –ò–∑–º–µ–Ω–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É (—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ/—Ä–µ–π—Ç–∏–Ω–≥/—Å—Ä–µ–¥–Ω–∏–π —á–µ–∫)

- [ ] **–®–∞–≥ 3:** –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä

- [ ] **–®–∞–≥ 4:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–ø–∏—Å–æ–∫ –æ–±–Ω–æ–≤–∏–ª—Å—è

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** –§–∏–ª—å—Ç—Ä—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ ‚úÖ

---

### –ó–∞–¥–∞—á–∞ 7.5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–≥–∏–æ–Ω–æ–≤ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã)
> ‚ö†Ô∏è **–¢–æ–ª—å–∫–æ –¥–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ A –∏ B**

- [ ] **–®–∞–≥ 1:** –ù–∞–π—Ç–∏ Region Picker –≤–≤–µ—Ä—Ö—É —ç–∫—Ä–∞–Ω–∞

- [ ] **–®–∞–≥ 2:** –ù–∞–∂–∞—Ç—å –Ω–∞ –Ω–µ–≥–æ

- [ ] **–®–∞–≥ 3:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ —Ä–µ–≥–∏–æ–Ω–æ–≤

- [ ] **–®–∞–≥ 4:** –í—ã–±—Ä–∞—Ç—å —Ä–µ–≥–∏–æ–Ω (–ú–æ—Å–∫–≤–∞ –∏–ª–∏ –°–ü–±)

- [ ] **–®–∞–≥ 5:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ä–µ–≥–∏–æ–Ω –ø—Ä–∏–º–µ–Ω–∏–ª—Å—è

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** Region picker —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ

---

### –ó–∞–¥–∞—á–∞ 7.6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã)
> ‚ö†Ô∏è **–¢–æ–ª—å–∫–æ –¥–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–∞ A**

- [ ] **–®–∞–≥ 1:** –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å MapSelectionView –≤–Ω–∏–∑

- [ ] **–®–∞–≥ 2:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–∫—Ü–∏—é "–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å"

- [ ] **–®–∞–≥ 3:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–∫—Ü–∏—é "–í —Ç—Ä–µ–Ω–¥–µ"

- [ ] **–®–∞–≥ 4:** –ù–∞–∂–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- [ ] **–®–∞–≥ 5:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ—Ç–∫—Ä—ã–ª–∞—Å—å –∫–æ—Ñ–µ–π–Ω—è

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞—é—Ç ‚úÖ

---

### –ó–∞–¥–∞—á–∞ 7.7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –∫–æ—Ñ–µ–π–Ω–∏
- [ ] **–®–∞–≥ 1:** –í—ã–±—Ä–∞—Ç—å –ª—é–±—É—é –∫–æ—Ñ–µ–π–Ω—é –∏–∑ —Å–ø–∏—Å–∫–∞

- [ ] **–®–∞–≥ 2:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ—Ç–∫—Ä—ã–ª–æ—Å—å –º–µ–Ω—é

- [ ] **–®–∞–≥ 3:** –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥

- [ ] **–®–∞–≥ 4:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –∫–æ—Ñ–µ–π–Ω—é

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** –í—ã–±–æ—Ä –∫–æ—Ñ–µ–π–Ω–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ

---

## üìã –§–ê–ó–ê 8: Documentation (–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)

> **–¶–µ–ª—å:** –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é  
> **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –í—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ñ–∞–∑—ã  
> **–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è:** –í—Å–µ—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

### –ó–∞–¥–∞—á–∞ 8.1: –°–æ–∑–¥–∞—Ç—å MAP_SELECTION_RESTORATION.md
- [x] **–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ
- [x] **–§–∞–π–ª:** `MAP_SELECTION_RESTORATION_PLAN.md`
- [x] **–î–∞—Ç–∞:** 2026-02-04

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** –î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω ‚úÖ

---

### –ó–∞–¥–∞—á–∞ 8.2: –û–±–Ω–æ–≤–∏—Ç—å README
- [ ] **–®–∞–≥ 1:** –û—Ç–∫—Ä—ã—Ç—å `SubscribeCoffieClean/README.md`

- [ ] **–®–∞–≥ 2:** –î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ü–∏—é "MapSelectionView Features"
  ```markdown
  ## MapSelectionView Features
  
  –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –∫–æ—Ñ–µ–π–Ω–∏ –≤–∫–ª—é—á–∞–µ—Ç:
  - ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –°–ø–∏—Å–æ–∫/–ö–∞—Ä—Ç–∞
  - ‚úÖ –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
  - ‚úÖ –§–∏–ª—å—Ç—Ä—ã –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
  - ‚úÖ –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã (–í–∞—Ä–∏–∞–Ω—Ç A, B)
  - ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∫–æ—Ñ–µ–π–Ω–∏ (–í–∞—Ä–∏–∞–Ω—Ç A)
  - ‚úÖ –¢—Ä–µ–Ω–¥–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã (–í–∞—Ä–∏–∞–Ω—Ç A)
  
  –°–º. `MAP_SELECTION_RESTORATION_PLAN.md` –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.
  ```

- [ ] **–®–∞–≥ 3:** –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:** README –æ–±–Ω–æ–≤–ª–µ–Ω ‚úÖ

---

## üéâ –ó–ê–í–ï–†–®–ï–ù–ò–ï

### –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

- [ ] **Backend:** –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- [ ] **Backend:** Seed data —Å–æ–∑–¥–∞–Ω
- [ ] **Backend:** RPC —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] **iOS:** –í—Å–µ —Ñ–∞–π–ª—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã/—Å–æ–∑–¥–∞–Ω—ã
- [ ] **iOS:** –ü—Ä–æ–µ–∫—Ç –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] **iOS:** –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** README –æ–±–Ω–æ–≤–ª–µ–Ω

### –ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

- [ ] **–®–∞–≥ 1:** –°–æ–∑–¥–∞—Ç—å –∫–æ–º–º–∏—Ç Backend
  ```bash
  cd SubscribeCoffieBackend
  git add -A
  git commit -m "feat: Enable regions and recommendations for MapSelectionView
  
  - Enabled multiregion migration
  - Enabled recommendations migration
  - Added seed data for regions (Moscow, SPb)
  - Added seed data for recommendations
  - All RPC functions tested and working
  
  Variant: [A/B/C]"
  ```

- [ ] **–®–∞–≥ 2:** –°–æ–∑–¥–∞—Ç—å –∫–æ–º–º–∏—Ç iOS
  ```bash
  cd ../SubscribeCoffieClean
  git add -A
  git commit -m "feat: Restore full MapSelectionView with all features
  
  - Restored RegionService and RecommendationService
  - Created CafeRecommendationsView and TrendingItemsView
  - Restored full MapSelectionView from disabled backup
  - Updated ContentView integration
  - Added optional dependencies support
  - All features tested and working
  
  Features:
  - ‚úÖ List/Map toggle
  - ‚úÖ Search
  - ‚úÖ Filters and sorting
  - ‚úÖ Region filtering (Variant A/B)
  - ‚úÖ Recommendations (Variant A)
  
  Variant: [A/B/C]"
  ```

---

## üìä –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê

### –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º

| –í–∞—Ä–∏–∞–Ω—Ç | –§–∞–∑—ã | –ó–∞–¥–∞—á–∏ | –í—Ä–µ–º—è |
|---------|------|--------|-------|
| A (–ü–æ–ª–Ω–æ–µ) | 1-8 | 25/25 | 3-4 —á |
| B (–†–µ–≥–∏–æ–Ω—ã) | 1,3,4,5,6,7,8 | 18/25 | 2-3 —á |
| C (–ú–∏–Ω–∏–º—É–º) | 5,6,7,8 | 10/25 | 1-2 —á |

### –§–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã/–∏–∑–º–µ–Ω–µ–Ω—ã

**Backend:**
- ‚úÖ `supabase/migrations/20260220000000_multiregion.sql`
- ‚úÖ `supabase/migrations/20260212000000_recommendations.sql`
- ‚úÖ `supabase/seed.sql` (–æ–±–Ω–æ–≤–ª—ë–Ω)

**iOS:**
- ‚úÖ `Helpers/RegionService.swift` (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
- ‚úÖ `Helpers/RecommendationService.swift` (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
- ‚úÖ `Views/RegionPickerView.swift` (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
- ‚úÖ `Views/CafeRecommendationsView.swift` (—Å–æ–∑–¥–∞–Ω)
- ‚úÖ `Views/TrendingItemsView.swift` (—Å–æ–∑–¥–∞–Ω)
- ‚úÖ `Views/MapSelectionView.swift` (–∑–∞–º–µ–Ω—ë–Ω)
- ‚úÖ `ContentView.swift` (–æ–±–Ω–æ–≤–ª—ë–Ω)

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- ‚úÖ `MAP_SELECTION_RESTORATION_PLAN.md` (—Å–æ–∑–¥–∞–Ω)
- ‚úÖ `MAP_SELECTION_TODO.md` (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
- üîÑ `README.md` (–Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å)

---

## üÜò Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π
npx supabase migration list

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å
npx supabase db reset --force
```

### –ü—Ä–æ–±–ª–µ–º–∞: RPC —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
psql "$DATABASE_URL" -c "\df public.get_all_regions"

# –ï—Å–ª–∏ –Ω–µ—Ç - –ø–µ—Ä–µ–ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
npx supabase db reset
```

### –ü—Ä–æ–±–ª–µ–º–∞: iOS –∫–æ–º–ø–∏–ª—è—Ü–∏—è –ø–∞–¥–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. Clean Build Folder (Cmd+Shift+K)
2. –ó–∞–∫—Ä—ã—Ç—å Xcode
3. –£–¥–∞–ª–∏—Ç—å DerivedData
   ```bash
   rm -rf ~/Library/Developer/Xcode/DerivedData
   ```
4. –û—Ç–∫—Ä—ã—Ç—å —Å–Ω–æ–≤–∞ –∏ Build (Cmd+B)

### –ü—Ä–æ–±–ª–µ–º–∞: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `enableRecommendations = true`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ user_preferences —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –µ—Å—Ç—å –∑–∞–∫–∞–∑—ã –≤ –∏—Å—Ç–æ—Ä–∏–∏
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Xcode Console

---

## ‚úÖ –ì–û–¢–û–í–û!

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–¥–∞—á:

üéâ **MapSelectionView –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!**

–§—É–Ω–∫—Ü–∏–∏:
- ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –°–ø–∏—Å–æ–∫/–ö–∞—Ä—Ç–∞
- ‚úÖ –ü–æ–∏—Å–∫ –∫–æ—Ñ–µ–π–Ω–∏
- ‚úÖ –§–∏–ª—å—Ç—Ä—ã –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
- ‚úÖ –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
- ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- ‚úÖ –¢—Ä–µ–Ω–¥–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã

**–ù–∞—Å–ª–∞–∂–¥–∞–π—Å—è —É–ª—É—á—à–µ–Ω–Ω—ã–º UX! üöÄ‚òï**
