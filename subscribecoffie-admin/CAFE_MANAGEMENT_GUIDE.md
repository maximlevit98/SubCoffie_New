# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Ñ–µ–π–Ω–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:

1. **–°–æ–∑–¥–∞–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ—Ñ–µ–π–Ω–∏**
   - –ü—É—Ç—å: `/admin/cafes/new`
   - –ö—Ä–∞—Å–∏–≤–∞—è —Ñ–æ—Ä–º–∞ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞ —Å–µ–∫—Ü–∏–∏
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª–µ–π

2. **–†–∞—Å—à–∏—Ä–µ–Ω–∞ —Å—Ö–µ–º–∞ –ë–î cafes**
   - ‚úÖ `phone` - —Ç–µ–ª–µ—Ñ–æ–Ω –∫–æ—Ñ–µ–π–Ω–∏
   - ‚úÖ `email` - email –¥–ª—è —Å–≤—è–∑–∏
   - ‚úÖ `description` - –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ—Ñ–µ–π–Ω–∏
   - ‚úÖ `latitude` / `longitude` - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –∫–∞—Ä—Ç—ã
   - ‚úÖ `opening_time` / `closing_time` - —á–∞—Å—ã —Ä–∞–±–æ—Ç—ã
   - ‚úÖ `max_active_orders` - –º–∞–∫—Å–∏–º—É–º –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
   - ‚úÖ `active_orders` - —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤

3. **–û–±–Ω–æ–≤–ª–µ–Ω—ã Server Actions**
   - `createCafe()` - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ –Ω–æ–≤—ã–µ –ø–æ–ª—è
   - `updateCafe()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ—Ñ–µ–π–Ω–∏
   - `deleteCafe()` - —É–¥–∞–ª–µ–Ω–∏–µ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
   - `updateCafeMode()` - –±—ã—Å—Ç—Ä–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
   - Audit logging –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

4. **–£–ª—É—á—à–µ–Ω UX**
   - –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –∫–æ—Ñ–µ–π–Ω—é" –≤ —Å–ø–∏—Å–∫–µ
   - –ò–∫–æ–Ω–∫–∏ –∏ —ç–º–æ–¥–∑–∏ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤
   - Placeholder-–ø–æ–¥—Å–∫–∞–∑–∫–∏ –≤ –ø–æ–ª—è—Ö
   - Required –ø–æ–ª—è –æ—Ç–º–µ—á–µ–Ω—ã *
   - –ö–Ω–æ–ø–∫–∏ "–û—Ç–º–µ–Ω–∞" –∏ "–°–æ–∑–¥–∞—Ç—å"

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ—Ñ–µ–π–Ω–∏

```
http://localhost:3000/admin/cafes
```

–ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–æ—Ñ–µ–π–Ω—é" –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É.

### 2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É

#### **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:**
- **–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ—Ñ–µ–π–Ω–∏** - –Ω–∞–ø—Ä–∏–º–µ—Ä: "Coffee House –Ω–∞ –ü—É—à–∫–∏–Ω–∞"
- **–ê–¥—Ä–µ—Å** - –Ω–∞–ø—Ä–∏–º–µ—Ä: "—É–ª. –ü—É—à–∫–∏–Ω–∞, –¥. 10"
- **–°—Ç–∞—Ç—É—Å** - –≤—ã–±—Ä–∞—Ç—å: üü¢ –û—Ç–∫—Ä—ã—Ç–æ / üü° –ú–Ω–æ–≥–æ –∑–∞–∫–∞–∑–æ–≤ / üü† –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ / üî¥ –ó–∞–∫—Ä—ã—Ç–æ

#### **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è:**

**–ö–æ–Ω—Ç–∞–∫—Ç—ã:**
- –¢–µ–ª–µ—Ñ–æ–Ω: `+7 (999) 123-45-67`
- Email: `cafe@example.com`
- –û–ø–∏—Å–∞–Ω–∏–µ: –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ—Ñ–µ–π–Ω–∏

**–†–∞–±–æ—á–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- –í—Ä–µ–º—è –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è (–º–∏–Ω): `15`
- –ú–∞–∫—Å. –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤: `10`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ CityPass: ‚úì
- –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞ (–∫–º): `2.5`
- –†–µ–π—Ç–∏–Ω–≥ (0-5): `4.5`
- –°—Ä–µ–¥–Ω–∏–π —á–µ–∫ (‚ÇΩ): `350`

**–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –∫–∞—Ä—Ç—ã:**
- –®–∏—Ä–æ—Ç–∞: `55.751244`
- –î–æ–ª–≥–æ—Ç–∞: `37.618423`

**–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã:**
- –û—Ç–∫—Ä—ã—Ç–∏–µ: `08:00`
- –ó–∞–∫—Ä—ã—Ç–∏–µ: `22:00`

### 3. –ù–∞–∂–∞—Ç—å "–°–æ–∑–¥–∞—Ç—å –∫–æ—Ñ–µ–π–Ω—é"

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–ø–∏—Å–∫–∞ –∫–æ—Ñ–µ–µ–Ω.

## API Schema

### –¢–∞–±–ª–∏—Ü–∞ `cafes`

```sql
CREATE TABLE public.cafes (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  name text NOT NULL,
  address text NOT NULL,
  phone text,
  email text,
  description text,
  mode text NOT NULL,
  eta_minutes integer,
  active_orders integer NOT NULL DEFAULT 0,
  max_active_orders integer,
  distance_km numeric,
  supports_citypass boolean NOT NULL DEFAULT true,
  brand_id uuid,
  latitude numeric(10, 6),
  longitude numeric(10, 6),
  opening_time time,
  closing_time time,
  rating numeric,
  avg_check_credits integer,
  created_at timestamptz NOT NULL DEFAULT now(),
  updated_at timestamptz NOT NULL DEFAULT now()
);
```

### Server Action: `createCafe(formData)`

**Input:**
```typescript
FormData {
  name: string;                    // required
  address: string;                 // required
  mode: 'open' | 'busy' | 'paused' | 'closed'; // required
  phone?: string;
  email?: string;
  description?: string;
  eta_minutes?: number;
  max_active_orders?: number;
  active_orders?: number;
  supports_citypass?: boolean;
  distance_km?: number;
  rating?: number;                // 0-5
  avg_check_credits?: number;
  latitude?: number;              // -90 to 90
  longitude?: number;             // -180 to 180
  opening_time?: string;          // HH:MM
  closing_time?: string;          // HH:MM
}
```

**Output:**
- Success: Redirect to `/admin/cafes`
- Error: Throws error with message

**Validation:**
- `name` - required, non-empty
- `address` - defaults to "‚Äî" if empty
- `mode` - defaults to "open"
- `rating` - must be 0-5
- `avg_check_credits` - must be >= 0
- `latitude` - must be -90 to 90
- `longitude` - must be -180 to 180
- `supports_citypass` - checkbox, defaults to false

## –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ—Ñ–µ–π–Ω—è

```
–ù–∞–∑–≤–∞–Ω–∏–µ: –ö–æ—Ñ–µ –Ω–∞ —É–≥–ª—É
–ê–¥—Ä–µ—Å: —É–ª. –õ–µ–Ω–∏–Ω–∞, 5
–°—Ç–∞—Ç—É—Å: –û—Ç–∫—Ä—ã—Ç–æ
```

### –ü—Ä–∏–º–µ—Ä 2: –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

```
–ù–∞–∑–≤–∞–Ω–∏–µ: Coffee House Premium
–ê–¥—Ä–µ—Å: —É–ª. –ü—É—à–∫–∏–Ω–∞, –¥. 10, –æ—Ñ–∏—Å 5
–¢–µ–ª–µ—Ñ–æ–Ω: +7 (495) 123-45-67
Email: info@coffeehouse.ru
–û–ø–∏—Å–∞–Ω–∏–µ: –ü—Ä–µ–º–∏—É–º –∫–æ—Ñ–µ–π–Ω—è —Å –∞–≤—Ç–æ—Ä—Å–∫–∏–º –∫–æ—Ñ–µ –∏ –¥–µ—Å–µ—Ä—Ç–∞–º–∏
–°—Ç–∞—Ç—É—Å: –û—Ç–∫—Ä—ã—Ç–æ
–í—Ä–µ–º—è –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è: 10 –º–∏–Ω
–ú–∞–∫—Å. –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤: 15
–ü–æ–¥–¥–µ—Ä–∂–∫–∞ CityPass: ‚úì
–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: 1.2 –∫–º
–†–µ–π—Ç–∏–Ω–≥: 4.8
–°—Ä–µ–¥–Ω–∏–π —á–µ–∫: 450‚ÇΩ
–®–∏—Ä–æ—Ç–∞: 55.751244
–î–æ–ª–≥–æ—Ç–∞: 37.618423
–û—Ç–∫—Ä—ã—Ç–∏–µ: 07:00
–ó–∞–∫—Ä—ã—Ç–∏–µ: 23:00
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å:

1. **–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**
   - –õ–æ–≥–æ—Ç–∏–ø –∫–æ—Ñ–µ–π–Ω–∏
   - –§–æ—Ç–æ –∏–Ω—Ç–µ—Ä—å–µ—Ä–∞
   - –§–æ—Ç–æ –º–µ–Ω—é

2. **–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è**
   - –í—ã–±–æ—Ä —Ç–æ—á–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ
   - –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –ø–æ –∞–¥—Ä–µ—Å—É

3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–æ–º**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ—Ñ–µ–π–Ω–∏ –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –∑–∞—è–≤–∫–∏
   - –ü—Ä–∏–≤—è–∑–∫–∞ owner-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ –∫–æ—Ñ–µ–π–Ω–µ

4. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —á–∞—Å—ã —Ä–∞–±–æ—Ç—ã**
   - –†–∞–∑–Ω—ã–µ —á–∞—Å—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏
   - –í—ã—Ö–æ–¥–Ω—ã–µ –¥–Ω–∏
   - –ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –¥–Ω–∏

5. **Bulk operations**
   - –ú–∞—Å—Å–æ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
   - –ò–º–ø–æ—Ä—Ç –∫–æ—Ñ–µ–µ–Ω –∏–∑ CSV
   - –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel

## Troubleshooting

### –û—à–∏–±–∫–∞: "Cannot connect to Supabase"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Supabase –∑–∞–ø—É—â–µ–Ω: `supabase status`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env.local` –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

### –û—à–∏–±–∫–∞: "Column does not exist"
- –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é: `supabase db reset --local`

### –§–æ—Ä–º–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (–Ω–∞–∑–≤–∞–Ω–∏–µ, –∞–¥—Ä–µ—Å)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é (—Ä–µ–π—Ç–∏–Ω–≥ 0-5, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ)

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –°—Ç–µ–∫:
- **Backend**: Supabase (PostgreSQL)
- **Frontend**: Next.js 14 (App Router)
- **Server Actions**: TypeScript
- **Styling**: Tailwind CSS

### –§–∞–π–ª—ã:
- `app/admin/cafes/new/page.tsx` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ñ–æ—Ä–º—ã
- `app/admin/cafes/actions.ts` - server actions
- `app/admin/cafes/page.tsx` - —Å–ø–∏—Å–æ–∫ –∫–æ—Ñ–µ–µ–Ω
- `supabase/migrations/20260131194204_add_cafe_details.sql` - –º–∏–≥—Ä–∞—Ü–∏—è

### Audit Logging:
–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–æ—Ñ–µ–π–Ω—è–º–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `audit_logs`:
- `create` - —Å–æ–∑–¥–∞–Ω–∏–µ
- `update` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ
- `delete` - —É–¥–∞–ª–µ–Ω–∏–µ

```sql
SELECT * FROM public.audit_logs 
WHERE table_name = 'cafes' 
ORDER BY created_at DESC 
LIMIT 10;
```

---

**–î–∞—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**: 31.01.2026  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç
