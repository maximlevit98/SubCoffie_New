# Analytics Quick Start Guide

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
cd SubscribeCoffieBackend
supabase db reset
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã

```bash
# –ü–æ–ª—É—á–∏—Ç—å DATABASE_URL
supabase status

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
psql $DATABASE_URL -f tests/analytics_functions.test.sql
```

### 3. –û—Ç–∫—Ä—ã—Ç—å Admin Panel

```bash
cd ../subscribecoffie-admin
npm install
npm run dev
```

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ http://localhost:3000/admin/dashboard

### 4. –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

#### –í Admin Panel:
- **–í—ã–±–æ—Ä –∫–∞—Ñ–µ** - –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∫–∞—Ñ–µ –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
- **–ú–µ—Ç—Ä–∏–∫–∏** - —Å–µ–≥–æ–¥–Ω—è, —ç—Ç–∞ –Ω–µ–¥–µ–ª—è, —ç—Ç–æ—Ç –º–µ—Å—è—Ü
- **–ö–æ–Ω–≤–µ—Ä—Å–∏—è** - –ø—Ä–æ—Ü–µ–Ω—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö/–æ—Ç–º–µ–Ω—ë–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
- **–ü–∏–∫–æ–≤—ã–µ —á–∞—Å—ã** - –≥—Ä–∞—Ñ–∏–∫ –∑–∞–∫–∞–∑–æ–≤ –ø–æ —á–∞—Å–∞–º –¥–Ω—è
- **–¢–æ–ø –ø–æ–∑–∏—Ü–∏–π** - —Å–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –±–ª—é–¥–∞

#### –í SQL:
```sql
-- –í—Å–µ –∫–∞—Ñ–µ
select * from get_dashboard_metrics(null);

-- –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∫–∞—Ñ–µ
select * from get_dashboard_metrics('cafe-uuid');

-- –ü–∏–∫–æ–≤—ã–µ —á–∞—Å—ã
select * from get_hourly_orders_stats(
  'cafe-uuid',
  now() - interval '7 days',
  now()
);

-- –ö–æ–Ω–≤–µ—Ä—Å–∏—è
select * from get_cafe_conversion_stats(
  'cafe-uuid',
  now() - interval '30 days',
  now()
);
```

## –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### Q: –ü–æ—á–µ–º—É –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø–∏–∫–æ–≤—ã–µ —á–∞—Å—ã?
**A:** –ü–∏–∫–æ–≤—ã–µ —á–∞—Å—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∫–∞—Ñ–µ (–Ω–µ "–í—Å–µ –∫–∞—Ñ–µ").

### Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏?
**A:** 
1. –î–æ–±–∞–≤—å—Ç–µ RPC —Ñ—É–Ω–∫—Ü–∏—é –≤ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
2. –î–æ–±–∞–≤—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –≤ `lib/supabase/queries/analytics.ts`
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ dashboard

### Q: –ö–∞–∫ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ?
**A:** –í –±—É–¥—É—â–µ–º –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω —ç–∫—Å–ø–æ—Ä—Ç –≤ CSV. –ü–æ–∫–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SQL:
```sql
\copy (select * from get_revenue_by_day('cafe-uuid', 30)) to 'revenue.csv' csv header
```

### Q: –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏?
**A:** –ù–µ—Ç, –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É. Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã –≤ –§–∞–∑–µ 2.

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ù–∞–π—Ç–∏ –ª—É—á—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è –∞–∫—Ü–∏–π
```sql
-- –ß–∞—Å—ã —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π (–¥–ª—è —Å—Ç–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ø—Ä–æ—Å–∞)
select hour_of_day, orders_count
from get_hourly_orders_stats('cafe-uuid', now() - interval '30 days', now())
order by orders_count
limit 3;
```

### –°—Ä–∞–≤–Ω–∏—Ç—å —ç—Ç—É –Ω–µ–¥–µ–ª—é —Å –ø—Ä–æ—à–ª–æ–π
```sql
select * from get_period_comparison(
  'cafe-uuid',
  date_trunc('week', now()),
  now(),
  date_trunc('week', now() - interval '7 days'),
  date_trunc('week', now())
);
```

### –ù–∞–π—Ç–∏ —Å–∞–º–æ–µ –ø—Ä–æ–¥–∞–≤–∞–µ–º–æ–µ –±–ª—é–¥–æ
```sql
select item_name, total_quantity
from get_top_menu_items('cafe-uuid', 1)
limit 1;
```

## Troubleshooting

### –û—à–∏–±–∫–∞ "function does not exist"
–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø—Ä–∏–º–µ–Ω–∏–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—é `20260205000000_hourly_stats.sql`:
```bash
supabase db reset
```

### –û—à–∏–±–∫–∞ "permission denied"
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:
```sql
select auth.uid(); -- –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å UUID
```

### –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω–¥–µ–∫—Å—ã:
```sql
select * from pg_indexes where tablename = 'orders';
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–Ω–¥–µ–∫—Å—ã –Ω–∞:
- `created_at`
- `cafe_id`
- `status`

## –î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏

1. ‚úÖ –ë–∞–∑–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≥–æ—Ç–æ–≤–∞
2. üîú –î–æ–±–∞–≤–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç –≤ CSV
3. üîú –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Chart.js –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
4. üîú –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –¥–∞—Ç–∞–º
5. üîú Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
6. üîú Mobile dashboard (iOS)

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `ANALYTICS_IMPLEMENTATION.md`
–¢–µ—Å—Ç—ã: `tests/analytics_functions.test.sql`
